# TopCalculator

## 整体架构设想

总体分为两个模块：

1. 数据抓取
2. 数据解析与计算

两部分独立存在，独立运行

分离的目的在于两个操作分离可提高处理数据稳定和灵活性

## 数据抓取

**目标：**

1. 尽可能不改变用户使用top习惯
2. 加入线程池，满足抓取某进程时可同步抓取其所有线程信息

**难点1：指令解析**

将一条top指令的参数拆解为三类作为python参数：

1. `-p` 和 `-f` 为必须输入
    1. `-p` 指定进程id。与top不同的是可以设置如 `-p pid1, pid2+, pid3` 或 `-p pid1, +pid2, pid3` 以此方式来表达哪些是需要异步获取线程信息的进程。
    2. `-f` 用于指定存储时的文件名
2. `-b` 为强制写入参数，由于我们需要将信息抓取到本地文件，因此该参数是不可缺少的批处理参数。为了避免丢失，因此将该参数强制写入。
3. `-o` 为top剩余参数，剩余参数均与原规则保持一致

在程序内部会依据上述三类参数拼接完整top指令，并判断是否需要异步获取线程信息

## 数据解析与计算

**目标：**

1. 仅需要用户传入文件路径即可进行解析和算计
2. 计算与解析分离，保证可以随时修改或增加计算方法

**难点1：groups构建**

读取文件时构建一个字典，其key为pid；value为具体数据集。结构如：`{pid1: {data: [], arg: ""}, {pid2: {data: [], arg: ""}}}`

解析流程如下：

1. 拿到文件中所有有效行，并拆分出信息
2. 获取pid，并构建空groups字典
3. 将数据集添加到对应group